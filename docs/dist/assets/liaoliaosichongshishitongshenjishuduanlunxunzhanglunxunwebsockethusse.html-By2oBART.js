import{_ as t,c as i,o as n,e as p}from"./app-vNkfWp6O.js";const e={},m=p('<p>这篇文章，我们聊聊 四种实时通信技术：短轮询、长轮询、WebSocket 和 SSE 。</p><h1 id="_1-短轮询" tabindex="-1"><a class="header-anchor" href="#_1-短轮询"><span>1 短轮询</span></a></h1><p>浏览器 <strong>定时</strong>（如每秒）向服务器发送 HTTP 请求，服务器立即返回当前数据（无论是否有更新）。</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVm4eUSzBymwEgYk4MK2wNREVm1ZKpcUib7RtRR0FgRl1CltGPUvQRtLfg/640?wx_fmt=png&amp;from=appmsg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><strong>优点</strong>：实现简单，兼容性极佳</li><li><strong>缺点</strong>：高频请求浪费资源，实时性差（依赖轮询间隔）</li><li><strong>延迟</strong>：高（取决于轮询频率）</li><li><strong>适用场景</strong>：兼容性要求高，延迟不敏感的简单场景。</li></ul><p>笔者职业生涯印象最深刻的短轮询应用场景是<strong>比分直播</strong>：</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmwoaY7ynDvCicfbOpibv46kmqgicWUxaOkmZxvUSFvgm5OmX6pXOhyOzTw/640?wx_fmt=png&amp;from=appmsg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图所示，用户进入比分直播界面，浏览器定时查询赛事信息（比分变动、黄红牌等），假如数据有变化，则重新渲染页面。</p><p>这种方式实现起来非常简单可靠，但是频繁的调用后端接口，会对后端性能会有影响（主要是 CPU）。同时，因为依赖轮询间隔，页面数据变化有延迟，用户体验并不算太好。</p><h1 id="_2-长轮询" tabindex="-1"><a class="header-anchor" href="#_2-长轮询"><span>2 长轮询</span></a></h1><p>浏览器发送 HTTP 请求后，服务器 <strong>挂起连接</strong> 直到数据更新或超时，返回响应后浏览器立即发起新请求。</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmibKzXlLjIpHzJHlfq2Gtnicb6ePlzh3z1GLtTm66wk2Rnsk3XMJibk5Sg/640?wx_fmt=png&amp;from=appmsg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><strong>优点</strong>：减少无效请求，比短轮询实时性更好</li><li><strong>缺点</strong>：服务器需维护挂起连接，高并发时资源消耗大</li><li><strong>延迟</strong>：中（取决于数据更新频率）</li><li><strong>适用场景</strong>：需要较好实时性且无法用 WebSocket/SSE 的场景（如消息通知）</li></ul><p>长轮询最常见的应用场景是：配置中心，我们耳熟能详的注册中心 Nacos 、阿波罗都是依赖长轮询机制。</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/V71JNV78n28WRbCSpJgdDcADjkGv7bVmFsxrwOTNL9SxpD0licLnns4cmshZ6Nd3XzYOibzNbUIqHQ1XbnxZjUxw/640?wx_fmt=other&amp;from=appmsg" alt="nacos长轮询" tabindex="0" loading="lazy"><figcaption>nacos长轮询</figcaption></figure><p>Nacos长轮询</p><blockquote><p>客户端发起请求后，Nacos 服务端不会立即返回请求结果，而是将请求挂起等待一段时间，如果此段时间内服务端数据变更，立即响应客户端请求，若是一直无变化则等到指定的超时时间后响应请求，客户端重新发起长轮询。</p></blockquote><h1 id="_3-websocket" tabindex="-1"><a class="header-anchor" href="#_3-websocket"><span>3 WebSocket</span></a></h1><p>基于 TCP 的全双工协议，通过 HTTP 升级握手（<strong>Upgrade: websocket</strong>）建立持久连接（<strong>双向实时通信）。</strong></p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmwRWKdEsE29SOz5icqfRcpjAJmoHlEyZ5apjGMJYy9icGQFYG9iaPk5HWA/640?wx_fmt=png&amp;from=appmsg" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ul><li><strong>优点</strong>：最低延迟，支持双向交互，节省带宽</li><li><strong>缺点</strong>：实现复杂，需单独处理连接状态</li><li><strong>延迟</strong>：极低</li><li><strong>适用场景</strong>：聊天室、在线游戏、协同编辑等 <strong>高实时双向交互</strong> 需求</li></ul><p>笔者曾经服务于北京一家电商公司，参与直播答题功能的研发。</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmSPzs6DhPC3qMn0U6N85WRicUSQJmgK0SL1Zicng2ewvkZO63rFDqRTMQ/640?wx_fmt=png&amp;from=appmsg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>直播答题整体架构见下图：</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmHEO5Yd9Sv28ibFQzR19icsiaAsjep13yf9gibZrBtM9F5cXE9xdlNl360A/640?wx_fmt=png&amp;from=appmsg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>TCP 网关的技术选型是：Netty、ProtoBuf、WebSocket ，选择 WebSocket 是因为它支持双向实时通信，同时 Netty 内置了 WebSocket 实现类，工程实现起来相对简单。</p><h1 id="_4-server-send-event-sse" tabindex="-1"><a class="header-anchor" href="#_4-server-send-event-sse"><span>4 Server Send Event(SSE)</span></a></h1><p>基于 HTTP 协议，服务器可 <strong>主动推送</strong> 数据流（如<code>Content-Type: text/event-stream</code>），浏览器通过<code>EventSource</code> API 监听。</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmSZHREpd2jZXHdHqf2sQuicxh0DkrPySREEzwzuLib3Byz2po9oK3TpLA/640?wx_fmt=png&amp;from=appmsg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><strong>优点</strong>：原生支持断线重连，轻量级（HTTP协议）</li><li><strong>缺点</strong>：单向通信（服务端--》客户端），低版本 IE 浏览器不支持</li><li><strong>延迟</strong>：低（服务器可即时推送）</li><li><strong>适用场景</strong>：股票行情、实时日志等 <strong>服务器单向推送</strong> 需求。</li></ul><p>SSE 最经典的应用场景是 ： DeepSeek web 聊天界面 ，如图所示：</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmKSnaLZ2AO44bCE91YdmPuvFnBSWrSib5N0QlZrFRQibBBZ9EHDy91FdA/640?wx_fmt=png&amp;from=appmsg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>当在 DeepSeek 对话框发送消息后，浏览器会发送一个 HTTP 请求 ，服务端会通过 SSE 方式将数据返回到浏览器。</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmty4iaiaWpRCeIv3dgZvbxDHw3E0ibA2xzKWpics1F1CRNlTcqeuCXFFX7g/640?wx_fmt=png&amp;from=appmsg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h1 id="_5-总结" tabindex="-1"><a class="header-anchor" href="#_5-总结"><span>5 总结</span></a></h1><table><thead><tr><th><strong>特性</strong></th><th><strong>短轮询</strong></th><th><strong>长轮询</strong></th><th><strong>SSE</strong></th><th><strong>WebSocket</strong></th></tr></thead><tbody><tr><td><strong>协议</strong></td><td>HTTP</td><td></td><td></td><td></td></tr><tr><td>HTTP</td><td></td><td></td><td></td><td></td></tr><tr><td>HTTP</td><td></td><td></td><td></td><td></td></tr><tr><td>WebSocket（基于TCP）</td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td><strong>实时性</strong></td><td>低</td><td></td><td></td><td></td></tr><tr><td>中</td><td></td><td></td><td></td><td></td></tr><tr><td>高</td><td></td><td></td><td></td><td></td></tr><tr><td>极高</td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td><strong>资源消耗</strong></td><td>高（频繁请求）</td><td></td><td></td><td></td></tr><tr><td>中（挂起连接）</td><td></td><td></td><td></td><td></td></tr><tr><td>低</td><td></td><td></td><td></td><td></td></tr><tr><td>低（长连接）</td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p><strong>选择建议</strong>：</p><ul><li>需要 <strong>简单兼容性</strong> → 短轮询</li><li>需要 <strong>中等实时性</strong> → 长轮询</li><li>只需 <strong>服务器推送</strong> → SSE</li><li>需要 <strong>全双工实时交互</strong> → WebSocket</li></ul><hr><p>往期推荐：</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIyNTYzNDE5MQ==&amp;mid=2247520060&amp;idx=1&amp;sn=c03b2b626e467243222d22591264222a&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">这几个实战专栏，相当炸裂！</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIyNTYzNDE5MQ==&amp;mid=2247519195&amp;idx=1&amp;sn=bfdc712051446c6abb1c9616978b5846&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">短信服务 platform-sms 0.6.1 发布</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIyNTYzNDE5MQ==&amp;mid=2247511645&amp;idx=1&amp;sn=b81aecc9ff727ef880c6bcf841169737&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">看完这一篇，ShardingSphere-jdbc 实战再也不怕了</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIyNTYzNDE5MQ==&amp;mid=2247520043&amp;idx=1&amp;sn=f06597b5a39236dbd5d34017d5a8d359&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">我写了一个教学型的任务调度系统，很强！</a></p><p>最后，欢迎加入我的知识星球，今年会有非常有趣的专栏，大家拭目以待。</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n29BJE4ZbEGbUCUQUhS7NC1IeZkOcYDEPePiawnRFJWbdYwrrrKg3TicgBauRPmEnqiaBoYjibTDZvT6ibQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p>记得<strong>添加我的微信（zhangyongtaozhe）</strong>：</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/V71JNV78n29BJE4ZbEGbUCUQUhS7NC1IecK5JPoyMv5grj1HJCpwb0QzNXcz8LyIsial6yYSaOzWzMY2OswSkwA/640?wx_fmt=jpeg&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><blockquote><p>参考链接：<a href="https://mp.weixin.qq.com/s/NIACuNgHtSFgKHc7T1G3Wg" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/NIACuNgHtSFgKHc7T1G3Wg</a>，整理：沉默王二</p></blockquote>',49),r=[m];function g(a,o){return n(),i("div",null,r)}const d=t(e,[["render",g],["__file","liaoliaosichongshishitongshenjishuduanlunxunzhanglunxunwebsockethusse.html.vue"]]),c=JSON.parse('{"path":"/nice-article/weixin/liaoliaosichongshishitongshenjishuduanlunxunzhanglunxunwebsockethusse.html","title":"聊聊四种实时通信技术：短轮询、长轮询、WebSocket 和 SSE","lang":"zh-CN","frontmatter":{"title":"聊聊四种实时通信技术：短轮询、长轮询、WebSocket 和 SSE","shortTitle":"聊聊四种实时通信技术：短轮询、长轮询、WebSocket 和 SSE","author":"勇哥","category":["微信公众号"],"description":"这篇文章，我们聊聊 四种实时通信技术：短轮询、长轮询、WebSocket 和 SSE 。 1 短轮询 浏览器 定时（如每秒）向服务器发送 HTTP 请求，服务器立即返回当前数据（无论是否有更新）。 优点：实现简单，兼容性极佳 缺点：高频请求浪费资源，实时性差（依赖轮询间隔） 延迟：高（取决于轮询频率） 适用场景：兼容性要求高，延迟不敏感的简单场景。 笔...","head":[["meta",{"property":"og:url","content":"https://javabetter.cn/nice-article/weixin/liaoliaosichongshishitongshenjishuduanlunxunzhanglunxunwebsockethusse.html"}],["meta",{"property":"og:site_name","content":"二哥的Java进阶之路"}],["meta",{"property":"og:title","content":"聊聊四种实时通信技术：短轮询、长轮询、WebSocket 和 SSE"}],["meta",{"property":"og:description","content":"这篇文章，我们聊聊 四种实时通信技术：短轮询、长轮询、WebSocket 和 SSE 。 1 短轮询 浏览器 定时（如每秒）向服务器发送 HTTP 请求，服务器立即返回当前数据（无论是否有更新）。 优点：实现简单，兼容性极佳 缺点：高频请求浪费资源，实时性差（依赖轮询间隔） 延迟：高（取决于轮询频率） 适用场景：兼容性要求高，延迟不敏感的简单场景。 笔..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVm4eUSzBymwEgYk4MK2wNREVm1ZKpcUib7RtRR0FgRl1CltGPUvQRtLfg/640?wx_fmt=png&from=appmsg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-23T04:09:56.000Z"}],["meta",{"property":"article:author","content":"勇哥"}],["meta",{"property":"article:modified_time","content":"2025-05-23T04:09:56.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"聊聊四种实时通信技术：短轮询、长轮询、WebSocket 和 SSE\\",\\"image\\":[\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVm4eUSzBymwEgYk4MK2wNREVm1ZKpcUib7RtRR0FgRl1CltGPUvQRtLfg/640?wx_fmt=png&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmwoaY7ynDvCicfbOpibv46kmqgicWUxaOkmZxvUSFvgm5OmX6pXOhyOzTw/640?wx_fmt=png&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmibKzXlLjIpHzJHlfq2Gtnicb6ePlzh3z1GLtTm66wk2Rnsk3XMJibk5Sg/640?wx_fmt=png&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_jpg/V71JNV78n28WRbCSpJgdDcADjkGv7bVmFsxrwOTNL9SxpD0licLnns4cmshZ6Nd3XzYOibzNbUIqHQ1XbnxZjUxw/640?wx_fmt=other&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmwRWKdEsE29SOz5icqfRcpjAJmoHlEyZ5apjGMJYy9icGQFYG9iaPk5HWA/640?wx_fmt=png&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmSPzs6DhPC3qMn0U6N85WRicUSQJmgK0SL1Zicng2ewvkZO63rFDqRTMQ/640?wx_fmt=png&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmHEO5Yd9Sv28ibFQzR19icsiaAsjep13yf9gibZrBtM9F5cXE9xdlNl360A/640?wx_fmt=png&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmSZHREpd2jZXHdHqf2sQuicxh0DkrPySREEzwzuLib3Byz2po9oK3TpLA/640?wx_fmt=png&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmKSnaLZ2AO44bCE91YdmPuvFnBSWrSib5N0QlZrFRQibBBZ9EHDy91FdA/640?wx_fmt=png&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVmty4iaiaWpRCeIv3dgZvbxDHw3E0ibA2xzKWpics1F1CRNlTcqeuCXFFX7g/640?wx_fmt=png&from=appmsg\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n29BJE4ZbEGbUCUQUhS7NC1IeZkOcYDEPePiawnRFJWbdYwrrrKg3TicgBauRPmEnqiaBoYjibTDZvT6ibQ/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1\\",\\"https://mmbiz.qpic.cn/sz_mmbiz_jpg/V71JNV78n29BJE4ZbEGbUCUQUhS7NC1IecK5JPoyMv5grj1HJCpwb0QzNXcz8LyIsial6yYSaOzWzMY2OswSkwA/640?wx_fmt=jpeg&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1\\"],\\"dateModified\\":\\"2025-05-23T04:09:56.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"勇哥\\"}]}"]]},"headers":[],"git":{"createdTime":1747973396000,"updatedTime":1747973396000,"contributors":[{"name":"沉默王二","email":"www.qing_gee@163.com","commits":1}]},"readingTime":{"minutes":4.16,"words":1249},"filePathRelative":"nice-article/weixin/liaoliaosichongshishitongshenjishuduanlunxunzhanglunxunwebsockethusse.md","localizedDate":"2025年5月23日","excerpt":"<p>这篇文章，我们聊聊 四种实时通信技术：短轮询、长轮询、WebSocket 和 SSE 。</p>\\n<h1>1 短轮询</h1>\\n<p>浏览器&nbsp;<strong>定时</strong>（如每秒）向服务器发送 HTTP 请求，服务器立即返回当前数据（无论是否有更新）。</p>\\n<figure><img src=\\"https://mmbiz.qpic.cn/sz_mmbiz_png/V71JNV78n28WRbCSpJgdDcADjkGv7bVm4eUSzBymwEgYk4MK2wNREVm1ZKpcUib7RtRR0FgRl1CltGPUvQRtLfg/640?wx_fmt=png&amp;from=appmsg\\" alt=\\"\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption></figcaption></figure>","autoDesc":true}');export{d as comp,c as data};
